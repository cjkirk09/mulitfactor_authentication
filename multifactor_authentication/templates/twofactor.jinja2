<!DOCTYPE html>
<html lang="{{request.locale_name}}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pyramid web application">
    <meta name="author" content="Pylons Project">
    <link rel="shortcut icon" href="{{request.static_url('multifactor_authentication:static/pyramid-16x16.png')}}">

    <title>Cookiecutter Alchemy project for the Pyramid Web Framework</title>

    <!-- Bootstrap core CSS -->
    <link href="//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this scaffold -->
    <link href="{{request.static_url('multifactor_authentication:static/theme.css')}}" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js" integrity="sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY" crossorigin="anonymous"></script>
      <script src="//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js" integrity="sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0" crossorigin="anonymous"></script>
    <![endif]-->
  </head>

  <body>

    <div class="starter-template">
      <div class="container">
        <div class="row">
          <div class="col-md-2">
            <img class="logo img-responsive" src="{{request.static_url('multifactor_authentication:static/pyramid.png') }}" alt="pyramid web framework">
          </div>
          <div class="col-md-10">
            <div class="content">
                <h1><span class="font-semi-bold">Two-Factor Authentication</span></h1>

                <h3>Enter you authentication code</h3>
                <div>
                    <label for="username">Username:</label>
                    <input id="username" type="text" placeholder="Enter your username"/>
                </div>
                <div>
                    <label for="code">Authentication Code:</label>
                    <input id="code" type="text" placeholder="Enter the code (no spaces)"/>
                </div>
                <div>
                    <button id="submitBtn">Submit</button>
                </div>
                <div class="message-container"><span id="message"></span></div>
                <div><a href="/create">Generate new secret</a></div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="links">
            <ul>
              <li><i class="glyphicon glyphicon-cog icon-muted"></i><a href="https://github.com/Pylons/pyramid">Github Project</a></li>
              <li><i class="glyphicon glyphicon-globe icon-muted"></i><a href="https://webchat.freenode.net/?channels=pyramid">IRC Channel</a></li>
              <li><i class="glyphicon glyphicon-home icon-muted"></i><a href="https://pylonsproject.org">Pylons Project</a></li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="copyright">
            Copyright &copy; Pylons Project
          </div>
        </div>
      </div>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js" integrity="sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h" crossorigin="anonymous"></script>
    <script src="//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js" integrity="sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4" crossorigin="anonymous"></script>
      <script>
        $(document).ready(function () {
            var submitting = false;
            $('#submitBtn').click(function () {
                if (!submitting) {
                    submitting = true;
                    $.post("/authenticate",
                        JSON.stringify({'code': $('#code').val(), 'username': $('#username').val()}),
                        function (data, status) {
                            submitting = false;
                            if (status === 'success') {
                                var message = $('#message');
                                if (data.success) {
                                    message.text('Valid');
                                    message.addClass('success');
                                    message.removeClass('error');
                                } else {
                                    message.text('Invalid');
                                    message.addClass('error');
                                    message.removeClass('success');
                                }
                            }
                    })
                        .fail(function () {
                            submitting = false;
                            message.text('Error');
                            message.addClass('error');
                            message.removeClass('success');
                        })
                }
            });
        });
    </script>
  </body>
</html>

